# Statistics Project   
"Анализ продаж аптечной сети: проверка гипотез"   

## Описание проекта   
**Контекст**   
В условиях высокой конкуренции и необходимости повышения операционной эффективности аптечной сети, состоящей из восьми точек, расположенных в разных районах города, перед компанией стоит задача обоснованной оптимизации бизнес-процессов. При ограниченных ресурсах особенно важно понимать, какие факторы реально влияют на ключевые показатели — такие как выручка, средний чек и прибыльность.  

Для этого применяется методология статистического тестирования гипотез, позволяющая количественно оценить значимость различных источников вариации: формат оплаты, день недели, тип покупки (онлайн или офлайн), а также различия между аптеками, сотрудниками и поставщиками. Такой подход даёт возможность не опираться на предположения, а принимать решения, основанные на данных — например, в вопросах управления персоналом, ассортиментной политики или работы с поставщиками.  

Задача проекта заключается в формировании набора проверенных гипотез, каждая из которых помогает ответить на вопрос: где именно находятся точки роста и резервы для повышения эффективности сети.  

**Цель проекта**  
Цель проекта — с помощью методов статистического тестирования гипотез выявить ключевые факторы, влияющие на продажи и прибыльность аптечной сети.  
В рамках анализа проверяются гипотезы о влиянии формы оплаты, дней недели, типа закупки, скидок, а также различий между аптеками, сотрудниками и поставщиками.  
Используя методы статистического тестирования гипотез, анализируются, какие источники вариации в данных наиболее значимы — поставщик, сотрудник, аптека или категория прибыльности и т.д..  
  
**Период**  
Тестирование гипотез проводилось на данных о продажах за период с 1 мая по 9 июня 2022 года.  

## Данные  
Датасет представляет собой реальные исторические данные о продажах сети из 8 региональных аптек, расположенных в различных районах города. Данные представлены за период с 2022-05-01 по 2022-06-09 включительно и состоят из 22 колонкок и 45128 строк. Вся необходимая для работы информация о транзакциях содержится в таблице sales.

| Column                  | Description                             | Data Type      |
| :---------------------- | :-------------------------------------- | :------------- |
| DR_Dat 	                | дата покупки	                           | DATE           |
| DR_Tim 	                | время покупки	                          | TIME           |
| DR_NChk 	               | номер чека	                             | INT(4)         |
| DR_NDoc 	               | номер кассового документа	              | INT(4)         |
| DR_apt 	                | номер магазина (FK  shops)	             | INT(4)         |
| DR_Kkm 	                | номер кассового аппарата	               | INT(4)         |
| DR_TDoc 	               | вид документа	                          | VARCHAR(100)   |
| DR_TPay 	               | форма платежа (18  безнал, 15 нал)	     | INT(4)         |
| DR_CDrugs 	             | артикул товара	                         | INT(4)         |
| DR_NDrugs 	             | название товара	                        | VARCHAR(100)   |
| DR_Suppl 	              | поставщик	                              | VARCHAR(100)   |
| DR_Prod 	               | производитель	                          | VARCHAR(100)   |
| DR_Kol 	                | кол-во проданного товара                |	FLOAT(8)       |
| DR_CZak 	               | закупочная цена	                        | FLOAT(8)       |
| DR_CRoz 	               | розничная цена	                         | FLOAT(8)       |
| DR_SDisc 	              | сумма скидки	                           | FLOAT(8)       |
| DR_CDisc 	              | код скидки	                             | TEXT           |
| DR_BCDisc 	             | штрихкод скидки	                        | TEXT           |
| DR_TabEmpl 	            | табельный номер сотрудника (FK - employee)  |	INT(4)     |
| DR_Pos 	                | номер позиции в чеке	                   | INT(4)         |
| DR_VZak 	               | вид закупки (1 - обычный, 2 -  интернет-заказ)	| INT(4)  |

Комментарии к структуре чеков и расчёту скидок:  
- Одному чеку может соответствовать несколько строк в таблице продаж (1 товарная позиция = 1 строка). Чек можно определить как комбинацию dr_apt, dr_nchk, dr_dat.   
- Скидка (DR_SDisc) применяется не к каждой штуке товара (DR_Kol), а к итоговому количеству. Перемножать эти поля не нужно.   




## Гипотезы и результаты  
Проверяемые гипотезы  

| №  | Гипотеза и формулировки H₀ / H₁                                                                                                  | Результат         | Ноутбук              |
|----|----------------------------------------------------------------------------------------------------------------------------------|-------------------|----------------------|
| 1  | **Форма оплаты и средний чек**  <br> H₀: Средний чек не зависит от формы оплаты (наличные / безналичные). <br> H₁: Средний чек различается в зависимости от формы оплаты. | H₀ отвергнута     | [hypothesis_01.ipynb](https://github.com/Advantl/Statistics_project/blob/main/notebooks/hypothesis_01.ipynb)  |
| 2  | **День недели и продажи**  <br> H₀: Средний объём продаж одинаковый в разные дни недели. <br> H₁: Есть статистически значимые различия в продажах между днями. | H₀ не отвергнута  | [hypothesis_02.ipynb](https://github.com/Advantl/Statistics_project/blob/main/notebooks/hypothesis_02.ipynb)  |
| 3  | **Продажи по будням и выходным**  <br> H₀: Средний объём продаж по будням и выходным одинаковый. <br> H₁: Есть статистически значимые различия в продажах по будням и по выходным. | H₀ не отвергнута  | hypothesis_03.ipynb  |
| 4  | **Эффективность сотрудников**  <br> H₀: Средние продажи сотрудников не различаются. <br> H₁: Существуют статистически значимые различия в эффективности сотрудников. | H₀ отвергнута     | [hypothesis_04.ipynb](https://github.com/Advantl/Statistics_project/blob/main/notebooks/hypothesis_04.ipynb)  |
| 5  | **Аптеки и выручка**  <br> H₀: Средний чек не зависит от аптеки. <br> H₁: Есть аптеки, у которых средний чек статистически выше/ниже. | H₀ отвергнута     | hypothesis_05.ipynb  |
| 6  | **Скидки и продажи**  <br> H₀: Скидки не оказывают значимого влияния на продажи. <br> H₁: Скидки увеличивают продажи (средний чек). | H₀ отвергнута     | hypothesis_06.ipynb  |
| 7  | **Тип закупки (обычная vs интернет-заказ)**  <br> H₀: Средний чек одинаковый для обычных покупок и интернет-заказов. <br> H₁: Средний чек различается для обычных покупок и интернет-заказов. | H₀ отвергнута     | hypothesis_07.ipynb  |
| 8  | **Различия в прибыли по поставщикам**  <br> H₀: Средняя прибыль от товаров разных поставщиков одинакова. <br> H₁: Средняя прибыль различается в зависимости от поставщика. | H₀ отвергнута     | hypothesis_08.ipynb  |
| 9  | **Доля прибыльных товаров у разных поставщиков**  <br> H₀: Доля товаров, приносящих положительную прибыль, одинакова для всех поставщиков. <br> H₁: Есть различия в доле прибыльных товаров между поставщиками. | H₀ отвергнута     | hypothesis_09.ipynb  |
| 10 | **Зависимость между поставщиком и категорией прибыльности**  <br> H₀: Категория прибыльности не зависит от поставщика. <br> H₁: Категория прибыльности зависит от поставщика. | H₀ отвергнута     | hypothesis_10.ipynb  |

## Отчет 
Обозначения для статистических тестов:  
✅ - Предпосылки выполнены, тест проведен.    
❌ - Проведение теста не представляется возможным из-за невыполнения необходимых предпосылок для его корректного применения.   

### Гипотеза №1.  

**«Форма оплаты и средний чек»**  
H₀: Средний чек не зависит от формы оплаты (наличные / безналичные).  
H₁: Средний чек различается в зависимости от формы оплаты.  

**Статистические тесты:**     
1. Kruskal-Wallis H-test ✅   
    - Размер эффекта Cliff's Delta    
2. Student’s t-test на логарифмически преобразованных данных ❌   
    - Shapiro–Wilk test  
    - D’Agostino & Pearson test  
    - Levene's test   
    - Проверка скоса (skewness) и эксцесса (kurtosis)  
3. Welch's t-test на логарифмически преобразованных данных ✅  

**Результаты:**
1. Статистические тесты Kruskal–Wallis и Welch t-test показали:  
- p-value ≈ 0.000, различия между группами существуют, и они не случайны.   
   
2. Размер эффекта Cliff’s Delta = -0.086, эффект незначительный (negligible):  
- То есть разница есть, но она очень мала по силе.  
Если взять случайного клиента, то вероятность того, что чек по карте будет выше, чем по наличке, лишь незначительно отличается от 50%.  

3. Средние значения:   
- наличные: 548 ₽   
- карта: 614 ₽   
Разница ≈ 66 ₽.  

**Значение для бизнеса:**  
Безналичные платежи ассоциируются с чуть более высоким средним чеком, но:  
- эффект микроскопический;  
- статистическая значимость получилась из-за большого объёма выборки (13k + 8k чеков), а не из-за реально ощутимой разницы.  


### Гипотеза №2.   
 
**«День недели и продажи»**  
H₀: Средний объём продаж одинаковый в разные дни недели.   
H₁: Есть статистически значимые различия в продажах между днями   

**Статистические тесты:**   
1. ANOVA ❌  
    - Shapiro-Wilk  
    - Kolmogorov-Smirnov  
    - Bartlett's test  
    - Levene's test  
2. Kruskal-Wallis ✅   
    - Пост-хок Mann-Whitney (Holm correction)  

**Результаты:**   
    
*Форма распределений сумм чеков по дням недели*   

![Violinplot: форма распределений сумм чеков по дням недели](visualizations/violinplot_day_of_week.png) 

Статистический тесты Kruskal–Wallis показал:  
- p-value > 0.05, нет статистически значимых различий между днями недели   
- Гипотеза H₀ "Средний объём продаж одинаковый в разные дни недели" не отвергнута.   
Это означает, что статистически значимых различий между распределениями сумм чеков по дням недели не найдено. Иными словами, продажи в понедельник, вторник, … воскресенье не различаются на уровне, значимом для статистики.   

**Значение для бизнеса:**   
С точки зрения статистики — нельзя утверждать, что день недели влияет на продажи.   
Возможно, есть небольшие тренды или колебания, но они не настолько сильные, чтобы пройти статистическую проверку. Текущий анализ показал: день недели не оказывает значимого влияния на продажи.   
    

### Гипотеза №3.     
**«Продажи по будням и выходным»**   
H₀: Средний объём продаж по будням и выходным одинаковый.    
H₁: Есть статистически значимые различия в продажах по будням и по выходным.   

**Статистические тесты:**    
1. Mann–Whitney U-test ✅   
    - размер эффекта Rank-biserial correlation   
2. Kruskal–Wallis test ✅   
    - Размера эффект Epsilon squared (ε²)   

**Результаты:**  
Статистические тесты Kruskal–Wallis и Mann–Whitney U показали:   
- p-value ≈ 0.061 означает, что при стандартном уровне значимости α = 0.05, различие не является статистически значимым.   
- Даже если бы результат был статистически значим, размер эффекта крайне мал (и в Mann–Whitney, и в Kruskal–Wallis).  
- Следовательно, различие между суммами чеков в будние и выходные дни почти отсутствует как в статистическом, так и в практическом смысле.  

**Значение для бизнеса:**   
Суммы покупок клиентов в будние и выходные дни практически не отличаются.  
•	Средний чек остаётся стабильным независимо от дня недели.  
•	Нет необходимости менять стратегию ценообразования, скидок или маркетинга в зависимости от типа дня.  
•	Акции или рекламные кампании, направленные на увеличение среднего чека, не требуют дифференциации по дням недели, так как поведение покупателей по чекам схоже.  


### Гипотеза №4.    

**«Эффективность сотрудников»**    
H₀: Средние продажи сотрудников не различаются.   
H₁: Существуют статистически значимые различия в эффективности сотрудников.    

**Статистические тесты:**    
1.  Kruskal-Wallis H-test  ✅    
    - размер эффекта Cliff's Delta    
2. Student’s t-test на логарифмически преобразованных данных ❌   
    - Shapiro–Wilk test   
    - D’Agostino & Pearson test   
    - Levene's test   
    - Проверка скоса (skewness) и эксцесса (kurtosis)    
3. Welch's t-test на логарифмически преобразованных данных ✅   
4. Многофакторный дисперсионный анализ (ANOVA, тип II) ✅   

Оговорка:  
Для оценки статистической значимости вклада факторов «сотрудник» и «аптека» в объяснение вариации среднего чека была использована многофакторная линейная модель с последующим дисперсионным анализом (ANOVA, тип II). Несмотря на некоторые отклонения от предпосылок метода (включая гетероскедастичность, асимметрию и разбалансированные группы), тест был применён как диагностический инструмент для выявления значимых эффектов.

**Результаты:**  
Многофакторный дисперсионный анализ показал, что средний чек статистически значимо зависит как от личности сотрудника, так и от аптеки, в которой он работает. Поскольку большинство сотрудников закреплены только за одной аптекой, взаимодействие между факторами оценить невозможно — эффекты сотрудника и аптеки частично неразделимы. Следовательно, при анализе индивидуальных различий сотрудников необходимо контролировать влияние аптеки (например, с помощью многоуровневых моделей или поправки на средний чек точки продаж).   

Для идентификации сотрудников, чьи показатели статистически значимо отличаются от большинства остальных, был применён пост-хок тест Данна с поправкой Бонферрони к множественным сравнениям. На основании полученной матрицы значений p-value для всех парных сравнений между сотрудниками, для каждого сотрудника была рассчитана доля сравнений, в которых наблюдались статистически значимые различия (p < 0.05).
Сотрудники, для которых эта доля превышала заданный порог (80%), рассматривались как статистически аномальные. Такой подход позволяет выявлять сотрудников, поведение которых (по среднему чеку) существенно отличается от поведения большинства, что может указывать как на наличие систематических отклонений, так и на потенциальные особенности в выполнении работы. 

**Визуализация результатов пост-хок анализа Данна в виде матрицы p-value для парных сравнений между сотрудниками**   
![Post-hoc Dunn Test (p-values между сотрудниками)](visualizations/heatmap_dr_tabempl.png)   

**Анализ сотрудников по доле значимых сравнений**   
![Анализ сотрудников по доле значимых сравнений](visualizations/barplot_by_dr_tabempl.png)   

1. Средний чек по аптекам   
Низкий средний чек: аптеки 7, 18, 15 (≈ 440–530).   
Средний уровень: аптеки 11, 13, 17 (≈ 545–590).  
Высокий чек: аптеки 6, 2 (≈ 760–790).  
Разрыв между «дешёвыми» и «дорогими» аптеками превышает 70%, что указывает на существенную неоднородность.

2. Аномальные сотрудники   
Выявлены сотрудники, чьи продажи значимо отличаются от коллег в их аптеках:   
- Сотрудник 15 в аптеке 11
- Сотрудник 27 в аптеках 2 и 6
- Сотрудник 123 в аптеке 2
    
Это может быть связано:   
- с успешными техниками продаж (upsell/cross-sell),   
- с риском несоблюдения стандартов (навязывание дорогих товаров).  
- с различным уровнем среднего чека аптек  

**Значение для бизнеса**    
1. Неоднородность аптек     
- Клиентские сегменты и ассортимент значительно различаются.  
- Аптеки 2 и 6 работают в «премиум»-сегменте, аптеки 7 и 18 — в «эконом».  

2. Кластеры аптек   
- Эконом (средний чек < 500)  
- Средний сегмент (500–600)  
- Премиум (> 750)

3. Аномалии сотрудников   
- Сотрудники могут быть «звёздами продаж» (позитивный сценарий).  
- Или создавать риски (жалобы клиентов, потеря лояльности).

**Рекомендации**
- Сегментировать аптеки по уровням среднего чека, установить разные KPI и стандарты для «эконом», «средних» и «премиум».
- Провести аудит аномальных сотрудников (структура чека, возвраты, жалобы).
- Лучшие практики продаж: если высокие чеки достигнуты корректными методами — использовать их для обучения остальных.
- Контроль рисков: ввести правила прозрачности рекомендаций и стандарты по ассортименту.
- Фокус на баланс: для «эконом»-аптек искать возможности повышения среднего чека (персонализированные рекомендации, допродажи). 


- Гипотеза → Подготовка данных (формирование выборок, eda) →  Тест(Методы анализа, Кратко о применённых техниках, Проверка предпосылок, Параметрические/непараметрические тесты, Пост-хок анализ ) → Визуализация → Интерпретация → Бизнес инсайты подробно.

## Дальнейшие шаги
- Какие ещё гипотезы можно проверить

## Техническая информация о проекте
- Стек
  
**Структура репозитория**   

Statistics_project/  
├── config/   
│   └── config.ini # Основной конфигурационный файл - скрыт   
│      
├── etl/  
│   ├── __init__.py    
│   ├── db_connection.py  # Получение данных из SQL   
│   └── data_cleaner.py  # Очистка данных  
│  
├── notebooks/   
│ ├── hypothesis_01.ipynb   
│ ├── hypothesis_02.ipynb   
│ ├── hypothesis_03.ipynb  
│ ├── hypothesis_04.ipynb   
│ ├── hypothesis_05.ipynb   
│ ├── hypothesis_06.ipynb   
│ ├── hypothesis_07.ipynb   
│ ├── hypothesis_08.ipynb   
│ ├── hypothesis_09.ipynb    
│ └── hypothesis_10.ipynb   
│         
├── visualizations/ # графики и таблицы    
├── requirements.txt  # Зависимости    
└── README.md # Описание проекта    
  
- Как воспроизвести   


